<ul>
<%	@origin.relationships.both.each do |relationship| %>
	<% id_stack.push(relationship.end_node.neo_node_id) # add to array of IDs in the tree (to stop looping) %>
	<% if (@origin.neo_node_id != relationship.end_node.neo_node_id ) then %>
		<%= render( :partial => "shared/relationship_maker", 
								:object => relationship, 
								:locals => {:origin => relationship.end_node, 
                            :target => @origin, 
                            :relationship => relationship}) %>
		<ul>
			<% relationship.end_node.relationships.both.each do |subrelationship| %>
				<% @flag = false %>
				<% id_stack.each do |id_instance| 
						 if (id_instance == subrelationship.end_node.neo_node_id) then
							 @flag = true
	           end
					 end
	      %>
				<% if (@flag == false) then %>
    		<%= render( :partial => "shared/relationship_maker", 
    								:object => subrelationship, 
    								:locals => {:origin => subrelationship.end_node, 
                                :target => relationship.end_node, 
                                :relationship => subrelationship}) %>
          <% id_stack.push(subrelationship.end_node.neo_node_id) # add to array of IDs in the tree (to stop looping) %>
      		<ul>
      			<% subrelationship.end_node.relationships.both.each do |subsubrelationship| %>
      				<% @flag = false %>
      				<% id_stack.each do |id_instance| 
      						 if (id_instance == subsubrelationship.end_node.neo_node_id) then
      							 @flag = true
      	           end
      					 end
      	      %>
      				<% if (@flag == false) then %>
          		<%= render( :partial => "shared/relationship_maker", 
          								:object => subsubrelationship, 
          								:locals => {:origin => subsubrelationship.end_node, 
                                      :target => subrelationship.end_node, 
                                      :relationship => subsubrelationship}) %>
                <% id_stack.push(subsubrelationship.end_node.neo_node_id) # add to array of IDs in the tree (to stop looping) %>
      				<% end %>
      			<% end %>
      		</ul>
				<% end %>
			<% end %>
		</ul>
	<% end %>
<% end %>
</ul>